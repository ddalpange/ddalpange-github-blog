---
title: Redux 마스터하기 - 리덕스의 미들웨어에 대하여 알아보자.
thumbnail: https://www.valentinog.com/blog/wp-content/uploads/2017/12/redux-react-tutorial-beginner-2018.png
date: 2019-01-11 18:39:55
tags: [Redux, Flux]
categories: [Redux]
---

`Redux`는 `Action`이 `Reducer`에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. `Redux`의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자.

<!-- more -->

```js api.js
let todoId = 0;

export const addTodo = text =>
  new Promise(resolve => {
    window.setTimeout(() => {
      resolve({
        text: text,
        id: todoId++,
        completed: false
      });
    }, 2000);
  });
```

`setTimeout`을 걸어 `Promise`를 반환하는 비동기 작업을 임시로 구현하였다. 위와 같은 비동기 작업이 있을때 `Redux`의 `Action`은 어떻게 처리해야 할까?


## Async / Await

간단하게 **Async / Await** 를 이용하여 동기적으로 구현할 수 있을것 같아서 테스트해보았다. 코드는 다음과 같다.

```js actions.js
import * as Api from "./api";

export const addTodo = async text => await Api.addTodo(text);
```

돌려보니 `Actions must be plain objects. Use custom middleware for async actions.`라는 에러가 뜨면서 되질 않는다. 액션은 순수한 객체여야 하며 비동기 액션을 위해서는 커스텀 미들웨어를 쓰라는 뜻이다.

## Redux Thunk

대표적으로 많이들 쓰는 [redux-thunk](https://github.com/reduxjs/redux-thunk)에 대하여 알아보자. 

```bash
npm install -S redux-thunk
```

기존 `action -> addTodo`는 단순한 **객체**를 리턴했지만 이제 비동기를 처리하기 위해 **dispatch를 인자로 받고 그에 대한 작업을 promise로 반환하는 함수**를 리턴해야한다. 
``redux-thunk``는 단순히 `action`에서 반환되어온 함수에 `dispatch`를 인자로 넣어 실행할 뿐이다. `redux-thunk`를 적용한 코드는 아래와 같다.

```js index.js
import { createStore, applyMiddleware } from "redux";
import { addTodo } from "./actions";
import reducers from "./reducers";
import ReduxThunk from "redux-thunk";

const store = createStore(reducers, applyMiddleware(ReduxThunk));

log("before", store.getState());
store.dispatch(addTodo("Hello world")).then(() => {
  log("after", store.getState());
});

function log(label, json) {
  const app = document.getElementById("app");
  app.innerHTML += `<h1>${label}<h1>`;
  app.innerHTML += `<pre>${JSON.stringify(json, undefined, 2)}</pre>`;
}
```

```js actions.js
import * as Api from "./api";

export const addTodo = text => dispatch =>
  Api.addTodo(text).then(todo => dispatch({ type: "ADD_TODO", newTodo: todo }));
```

CodeSandBox에 예제를 올려두었다.

<iframe src="https://codesandbox.io/embed/kmx0w14lo3" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

## Redux Saga

작성 예정.
